window.cwe=window.cwe||{};
(function(b){function v(){for(var d={},a,w=l.length,g=0;g<w;g++){var e=l[g];var c=e.word;a=[];c=c.toLowerCase();for(var b=0;b<c.length;b++){var f=c.charAt(b);CWECharacterSet.wordSeparatorCharacterSet.characterIsMember(f)?CWECharacterSet.whiteSpaceCharacterSet.characterIsMember(f)?0!=a.length&&0==a[a.length-1].length||a.push(""):(0==a.length||0!=a[a.length-1].length?a.push(f):a[a.length-1]+=f,a.push("")):0==a.length?a.push(f):a[a.length-1]+=f}c=a;a=d;for(f=0;f<c.length;f++)0<c[f].length&&(a.hasOwnProperty(c[f])?
a=a[c[f]]:a[c[f]]=a={});a.hasOwnProperty("@")?a["@"].push(e.id):a["@"]=[e.id]}return d}function p(d){if(d)try{d.apply(this,[].slice.call(arguments).splice(1))}catch(a){Logger.instance.error(a)}}var r=-1,l=[],n=[],m=[],t=[],q={},u=0,h=new CWETimeTracker,k=!1;b.initialize=function(d){CWEBackgroundManager.instance.requestFileSystem(function(a){a.readFile("wordList",function(a){if(a)try{var g=JSON.parse(a);r=g.version;l=g.words;n=g.tree}catch(e){Logger.instance.error(e)}p(d)})},function(){p(d)})};b.enablePrivacyMode=
function(d){d!=k&&(d&&(h.stop(),b.reset()),k=d)};b.timeTracker=function(){return h};b.startTimeTracker=function(){return k?null:h.start()};b.stopTimeTracker=function(){return k?null:h.stop()};b.totalTime=function(){return k?null:h.total()};b.version=function(){return r};b.words=function(){return l};b.tree=function(){return n};b.update=function(d,a){if(!d||!d.version||!d.words)return p(a);r=d.version;l=d.words||l;n=v();CWEBackgroundManager.instance.requestFileSystem(function(b){d=JSON.stringify({version:r,
words:l,tree:n});b.writeFile("wordList",d,function(){p(a)})},function(){p(a)})};b.accumulateAndMeasureData=function(d){if(!k&&(d||0!=m.length&&0!=m[m.length-1].length)){var a=m,b=t;var g=(d||" ").toLowerCase();for(var e=0;e<g.length;e++){var c=g.charAt(e);CWECharacterSet.wordSeparatorCharacterSet.characterIsMember(c)?(CWECharacterSet.whiteSpaceCharacterSet.characterIsMember(c)||(0==a.length||0!=a[a.length-1].length?(a.push(c),b.push(0)):(a[a.length-1]+=c,b[b.length-1]=0)),a.push(""),b.push(0)):"\b"==
c?0<a.length&&(0==a[a.length-1].length?(a.splice(a.length-1,1),b.splice(b.length-1,1)):(a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-1),b[b.length-1]=0)):0==a.length?(a.push(c),b.push(0)):(a[a.length-1]+=c,b[b.length-1]=0)}g=m;c=t;if(0<g.length&&0==g[g.length-1].length&&0==c[c.length-1]){a=n;var h,f;for(e=0;e<g.length;e++)if(0==g[e].length)c[e]=1;else{if(0==c[e]){if(1<g[e].length||!CWECharacterSet.wordSeparatorCharacterSet.characterIsMember(g[e]))u+=1;c[e]=1}if(a.hasOwnProperty(g[e])){if(a=
a[g[e]],2!=c[e]&&a.hasOwnProperty("@")&&(h=a["@"]))for(f=0;f<h.length;f++)b=h[f],q[b]=(q[b]||0)+1,c[e]=2}else{a=n;g.splice(0,1);c.splice(0,1);for(f=0;f<c.length;f++)2==c[f]&&(c[f]=1);e=-1}}}d||(m=[],t=[])}};b.measurementResults=function(b){if(k)return null;var a={words:q,totalWords:u,totalTime:h.total()};b&&(q={},u=0,h.reset());return a};b.reset=function(){k||(m=[],t=[],q={},u=0,h.reset())}})(window.cwe.measure=window.cwe.measure||{});
