function CWEBackgroundPort(a,b,c){if(!c)throw Error("Invalid arguments: listener is not provided!");this.m_port=a;this.m_tabId=b;this.m_listener=c;this.m_messageMap={"com.donjohnston.cowriter.chrome.message.topics.update":c.updateTopic,"com.donjohnston.cowriter.chrome.message.topics.activate":c.activateTopic};this.__intialize();return this}CWEBackgroundPort.prototype.__intialize=function(){var a=this;this.m_port.onDisconnect.addListener(function(b){a.__onPortDisconnect(b)});this.m_port.onMessage.addListener(function(b){a.__onPortMessage(b)})};
CWEBackgroundPort.prototype.__onPortDisconnect=function(a){Logger.instance.log("CWEBackgroundPort.__onPortDisconnect");Logger.instance.log(a);this.m_listener&&this.m_listener.__onPortDisconnect(this.m_tabId,this.m_port)};
CWEBackgroundPort.prototype.__onPortMessage=function(a){if(CWEBackgroundManager.instance.m_loaded)if(Logger.instance.log(a),"com.donjohnston.cowriter.chrome.message.toggleOnOff"===a.message)this.m_listener&&this.m_listener.toggleOnOff();else if("com.donjohnston.cowriter.chrome.message.needSetup"===a.message)this.m_listener&&this.m_listener.tabNeedsSetup(this.m_tabId,a.details);else if("com.donjohnston.cowriter.chrome.message.documentReady"===a.message)this.m_listener&&this.m_listener.documentReadyInTab(this.m_tabId);
else if("com.donjohnston.cowriter.chrome.message.documentCapabilitiesUpdate"===a.message)this.m_listener&&this.m_listener.documentCapabilitiesUpdateInTab(this.m_tabId,a.details);else if("com.donjohnston.cowriter.chrome.message.restartGuesses"===a.message)CWEPredictionEngine.instance&&CWEPredictionEngine.instance.restartGuesses();else if("com.donjohnston.cowriter.chrome.message.contextAvailable"===a.message)this.m_listener&&this.m_listener.contextAvailable(this.m_tabId,a.context,a.requestId);else if("com.donjohnston.cowriter.chrome.message.contextForMomentaryTopicAvailable"===
a.message)CWEPredictionEngine.instance?CWEPredictionEngine.instance.updateMomentaryTopic(a.context.text):Logger.instance.log(a.context.text);else if("com.donjohnston.cowriter.chrome.message.guessSelected"===a.message)CWEPredictionEngine.instance?CWEPredictionEngine.instance.acceptGuess(a.guess):Logger.instance.log(a.guess);else if("com.donjohnston.cowriter.chrome.message.scheduleSpeak"===a.message)this.m_listener&&this.m_listener.scheduleSpeakInTab(this.m_tabId,a.text,a.stopCurrentSpeech);else if("com.donjohnston.cowriter.chrome.message.speak"===
a.message)this.m_listener&&this.m_listener.speakInTab(this.m_tabId,a.text,a.force);else if("com.donjohnston.cowriter.chrome.message.stopspeak"===a.message)this.m_listener&&this.m_listener.stopSpeakInTab(this.m_tabId);else if("com.donjohnston.cowriter.chrome.message.onAddPersonalWords"===a.message){if(this.m_listener)this.m_listener.onAddPersonalWords(this.m_tabId,a.text)}else if("com.donjohnston.cowriter.chrome.message.onRemovePersonalWords"===a.message){if(this.m_listener)this.m_listener.onRemovePersonalWords(this.m_tabId,
a.text)}else if("com.donjohnston.cowriter.chrome.message.imeActivationChanged"===a.message)this.m_listener&&this.m_listener.imeActivationChanged(a.active);else if("com.donjohnston.cowriter.chrome.message.accumulateData"===a.message)this.m_listener&&this.m_listener.accumulateAndMeasureData(a.text);else if("com.donjohnston.cowriter.chrome.message.speechRecognition"===a.message)this.m_listener&&this.m_listener.toggleSpeechRecognition(this.m_tabId,a.on,a.langCode,a.scope,a.session);else{var b=a.options?
a.options.callbackMessage||a.message:a.message,c=this.m_messageMap.hasOwnProperty(a.message)?this.m_messageMap[a.message]:void 0;if(!(c instanceof Function))return this.m_port.postMessage({message:b,error:"No valid handler has been registered!"});var d=this;c.call(this.m_listener,this.m_tabId,a.params,function(a){d.m_port.postMessage({message:b,params:a})})}};CWEBackgroundPort.prototype.port=function(){return this.m_port};
