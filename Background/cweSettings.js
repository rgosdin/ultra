function CWESettingsInstance(){return CWESettings.instance}function CWESettings(a){this.m_listener=a;this.m_userSettings=new CWEUserSettings;this.m_userSettings.reset();this.m_testingMode=null;this.m_settingsStack=[{settings:this.m_userSettings,testingMode:this.m_testingMode}];return this}CWESettings.instance=null;CWESettings.initialize=function(a){null===CWESettings.instance&&(CWESettings.instance=new CWESettings(a))};
CWESettings.prototype.reload=function(a,b){this.m_userSettings=new CWEUserSettings;this.m_testingMode=null;this.m_settingsStack=[{settings:this.m_userSettings,testingMode:this.m_testingMode}];this.load(b)};CWESettings.prototype.load=function(a){var b=this;this.m_userSettings.reset();CWEDataManager.instance.loadUserSettings(function(c){c&&b.m_userSettings.updateFromLocalData(c);if(a)try{a()}catch(d){Logger.instance.error(d)}})};
CWESettings.prototype.save=function(a){this.m_testingMode?a&&a():(this.m_userSettings.markAsModified(),CWEDataManager.instance.saveUserSettings(this.m_userSettings,a))};
CWESettings.prototype.enterTestingMode=function(a){if(this.m_testingMode===a)return!1;if(!a||0===a.length)return this.leaveTestingMode();this.leaveTestingMode();this.m_userSettings=this.m_userSettings?this.m_userSettings.clone():new CWEUserSettings;this.m_testingMode=a;this.m_settingsStack.unshift({settings:this.m_userSettings,testingMode:this.m_testingMode});return!0};
CWESettings.prototype.leaveTestingMode=function(){if(!this.m_testingMode)return!1;1<this.m_settingsStack.length&&this.m_settingsStack.splice(0,1);this.m_userSettings=this.m_settingsStack[0].settings;this.m_testingMode=this.m_settingsStack[0].testingMode;return!0};CWESettings.prototype.isInTestingMode=function(a){var b=a&&0<a.length,c=this.m_testingMode&&0<this.m_testingMode.length;return!b&&c||b&&a===this.m_testingMode};CWESettings.prototype.data=function(){return this.m_userSettings};
CWESettings.prototype.testingMode=function(){return this.m_testingMode};CWESettings.prototype.allowChanges=function(){return(this.m_userSettings.dapiData||{}).allowChanges||["<all>"]};CWESettings.prototype.speech=function(){return this.m_userSettings.speech};CWESettings.prototype.text=function(){return this.m_userSettings.text};CWESettings.prototype.guessWindow=function(){return this.m_userSettings.guessWindow};CWESettings.prototype.prediction=function(){return this.m_userSettings.prediction};
CWESettings.prototype.guessWindowForUI=function(){return{fontFamily:this.m_userSettings.guessWindow.fontFamily,fontSize:this.guessWindowFontSizeInPixels(),textColor:this.m_userSettings.guessWindow.textColor,backgroundColor:this.m_userSettings.guessWindow.backgroundColor}};CWESettings.prototype.speechVoice=function(a){if(a&&a!==this.m_userSettings.speech.voice)this.m_userSettings.speech.voice=a,this.save();else return this.m_userSettings.speech.voice};
CWESettings.prototype.speechRate=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.speech.rate)this.m_userSettings.speech.rate=a,this.save();else return this.m_userSettings.speech.rate};CWESettings.prototype.speechPitch=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.speech.pitch)this.m_userSettings.speech.pitch=a,this.save();else return this.m_userSettings.speech.pitch};
CWESettings.prototype.speechVolume=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.speech.volume)this.m_userSettings.speech.volume=a,this.save();else return this.m_userSettings.speech.volume};CWESettings.prototype.speechLetters=function(a){if(void 0!==a&&null!==a&&a!=this.m_userSettings.speech.letters)this.m_userSettings.speech.letters=a,this.save();else return this.m_userSettings.speech.letters};
CWESettings.prototype.speechWords=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.speech.words)this.m_userSettings.speech.words=a,this.save();else return this.m_userSettings.speech.words};CWESettings.prototype.speechSentences=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.speech.sentences)this.m_userSettings.speech.sentences=a,this.save();else return this.m_userSettings.speech.sentences};
CWESettings.prototype.textFontFamily=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.text.fontFamily)this.m_userSettings.text.fontFamily=a,this.save();else return this.m_userSettings.text.fontFamily};CWESettings.prototype.textFontSize=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.text.fontSize)this.m_userSettings.text.fontSize=a,this.save();else return this.m_userSettings.text.fontSize};
CWESettings.prototype.textColor=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.text.textColor)this.m_userSettings.text.textColor=a,this.save();else return this.m_userSettings.text.textColor};CWESettings.prototype.textBackgroundColor=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.text.backgroundColor)this.m_userSettings.text.backgroundColor=a,this.save();else return this.m_userSettings.text.backgroundColor};
CWESettings.prototype.textMarginSize=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.text.marginSize)this.m_userSettings.text.marginSize=a,this.save();else return this.m_userSettings.text.marginSize};CWESettings.prototype.guessWindowFontFamily=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.guessWindow.fontFamily)this.m_userSettings.guessWindow.fontFamily=a,this.save();else return this.m_userSettings.guessWindow.fontFamily};
CWESettings.prototype.guessWindowFontSize=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.guessWindow.fontSize)this.m_userSettings.guessWindow.fontSize=a,this.save();else return this.m_userSettings.guessWindow.fontSize};CWESettings.prototype.guessWindowColor=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.guessWindow.textColor)this.m_userSettings.guessWindow.textColor=a,this.save();else return this.m_userSettings.guessWindow.textColor};
CWESettings.prototype.guessWindowBackgroundColor=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.guessWindow.backgroundColor)this.m_userSettings.guessWindow.backgroundColor=a,this.save();else return this.m_userSettings.guessWindow.backgroundColor};
CWESettings.prototype.predictionGuesses=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.prediction.guesses)this.m_userSettings.prediction.guesses=a,this.save(),this.m_listener&&this.m_listener.settingsChangedPredictionGuesses(a);else return this.m_userSettings.prediction.guesses};
CWESettings.prototype.predictionMainDictionary=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.prediction.mainDictionary)this.m_userSettings.prediction.mainDictionary=a,this.save(),this.m_listener&&this.m_listener.settingsChangedPredictionMainDictionary(a);else return this.m_userSettings.prediction.mainDictionary};
CWESettings.prototype.predictionMomentaryTopic=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.prediction.momentaryTopic)this.m_userSettings.prediction.momentaryTopic=a,this.save(),this.m_listener&&this.m_listener.settingsChangedPredictionMomentaryTopic(a);else return this.m_userSettings.prediction.momentaryTopic};
CWESettings.prototype.predictionFlexibleSpelling=function(a){if(void 0!==a&&null!==a&&a!==this.m_userSettings.prediction.flexibleSpelling)this.m_userSettings.prediction.flexibleSpelling=a,this.save(),this.m_listener&&this.m_listener.settingsChangedPredictionFlexibleSpelling(a);else return this.m_userSettings.prediction.flexibleSpelling};CWESettings.prototype.predictionGrammar=function(){return this.m_userSettings.prediction.grammar};CWESettings.prototype.predictionAhead=function(){return this.m_userSettings.prediction.ahead};
CWESettings.prototype.topicsActive=function(a){if(void 0!==a&&null!==a)this.m_userSettings.topics.active=a,this.save();else return this.m_userSettings.topics.active};CWESettings.prototype.topicsRecent=function(a){if(void 0!==a&&null!==a)this.m_userSettings.topics.recent=a,this.save();else return this.m_userSettings.topics.recent};CWESettings.prototype.setActiveAndRecentTopics=function(a,b){a&&(this.m_userSettings.topics.active=a);b&&(this.m_userSettings.topics.recent=b);(a||b)&&this.save()};
CWESettings.prototype.translationSource=function(a){if(void 0!==a&&a!==this.m_userSettings.translation.source)this.m_userSettings.translation.source=a,this.save();else return this.m_userSettings.translation.source};
CWESettings.prototype.window=function(){return{scale:this.guessWindowScale(),suggestions:this.m_userSettings.prediction.guesses+(this.m_userSettings.translation.source?1:0),fontFamily:this.m_userSettings.guessWindow.fontFamily,fontScale:this.m_userSettings.guessWindow.fontSize,textColor:this.m_userSettings.guessWindow.textColor,backgroundColor:this.m_userSettings.guessWindow.backgroundColor}};
CWESettings.prototype.guessWindowScale=function(){var a=this.m_userSettings.guessWindow.fontSize;return 50>a?.7+a/50*(1-.7):1+(a-50)/50*.5};CWESettings.prototype.guessWindowFontSizeInPixels=function(){var a=10+38*this.m_userSettings.guessWindow.fontSize/100;return a=parseInt(a)};CWESettings.prototype.dump=function(){};
